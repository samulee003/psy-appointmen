# 微信小程式雲開發研究筆記

## 微信雲開發概述

微信雲開發（CloudBase）是微信官方提供的一站式後端雲服務，專為小程式開發者設計，無需搭建服務器，即可使用雲端能力。主要包含以下核心功能：

1. **雲數據庫**：一個 JSON 數據庫，用於存儲小程式的數據
2. **雲函數**：無需管理服務器，可以在雲端運行代碼
3. **雲存儲**：提供文件存儲服務
4. **雲調用**：可以在雲函數中調用微信開放能力

## 小程式開發環境設置

1. **微信開發者工具**：官方IDE，用於開發、調試和預覽小程式
2. **AppID申請**：在微信公眾平台申請小程式AppID
3. **開通雲開發**：在微信開發者工具中開通雲開發環境

## 日曆組件研究

微信小程式提供了內置的日曆組件，可以通過以下方式使用：

1. **原生組件**：`<calendar />`
2. **自定義組件**：可以基於微信提供的日期選擇器進行二次開發

對於心理諮詢預約系統，我們需要：
- 顯示可預約和已預約的時段
- 支持按小時為單位的時段選擇
- 支持醫生批量生成和修改時段

## 數據庫設計思路

基於雲數據庫，我們需要設計以下集合（表）：

1. **doctors**：存儲醫生信息
2. **timeslots**：存儲可預約時段
3. **appointments**：存儲預約信息
4. **patients**：存儲患者基本信息（姓名和電話，需加密）

## 微信通知API

微信提供了訂閱消息功能，可用於發送：
1. 預約成功通知
2. 預約提醒（24小時前）
3. 預約取消通知

使用訂閱消息需要：
1. 在微信公眾平台配置訂閱消息模板
2. 獲取用戶授權
3. 通過API發送消息

## 數據加密存儲

為保護患者隱私，我們需要：
1. 使用微信雲開發提供的加密API
2. 對敏感信息（姓名、電話）進行加密存儲
3. 確保只有授權醫生可以解密查看

## 導出Excel功能

可以通過以下步驟實現：
1. 雲函數查詢預約數據
2. 使用原生JS處理數據格式
3. 生成Excel文件並存儲到雲存儲
4. 生成二維碼供醫生掃描下載

## 技術實現難點及解決方案

1. **不使用第三方庫的Excel生成**：
   - 使用純JS生成CSV格式文件
   - 利用微信文件系統API保存

2. **預約時段管理**：
   - 使用雲數據庫事務確保並發安全
   - 實時更新已預約時段狀態

3. **微信通知定時發送**：
   - 使用雲函數定時觸發器
   - 掃描需要發送提醒的預約記錄
